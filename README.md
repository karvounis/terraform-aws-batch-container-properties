# terraform-aws-batch-container-properties

[![terraform](https://img.shields.io/badge/terraform-%23623CE4?style=flat-square&logo=terraform&logoColor=white)](https://www.terraform.io/)
[![aws](https://img.shields.io/badge/aws-%23232F3E?style=flat-square&logo=amazon-aws&logoColor=white)](https://docs.aws.amazon.com/index.html)
[![pre-commit](https://img.shields.io/badge/pre--commit-enabled-brightgreen?style=flat-square&logo=pre-commit&logoColor=white)](https://github.com/pre-commit/pre-commit)
![GitHub tag (latest SemVer)](https://img.shields.io/github/v/tag/karvounis/terraform-aws-batch-container-properties?sort=semver&color=blue&logoColor=white&logo=github&style=flat-square&label=latest)
![GitHub Release Date](https://img.shields.io/github/last-commit/karvounis/terraform-aws-batch-container-properties?logo=github)
![GitHub](https://img.shields.io/github/license/karvounis/terraform-aws-batch-container-properties?style=flat-square&logo=github)

Terraform module that generates the container properties object to use in AWS Batch.

## AWS Documentation
* https://docs.aws.amazon.com/batch/latest/APIReference/API_ContainerProperties.html
* https://docs.aws.amazon.com/batch/latest/userguide/job_definition_parameters.html#containerProperties

Fast-tracked using [Simple Terraform Template](https://github.com/karvounis/simple-terraform-template).

README file is autogenerated using [terraform-docs](https://github.com/terraform-docs/terraform-docs)!

## Support

If you like my work, please consider donating!

[![buy-me-coffee](https://img.shields.io/badge/buy--me--coffee-%23FFDD00?style=flat-square&logo=buy-me-a-coffee&logoColor=black)](https://www.buymeacoffee.com/karvounis)
[![liberapay](https://img.shields.io/badge/liberapay-%23F6C915?style=flat-square&logo=liberapay&logoColor=black)](https://liberapay.com/karvounis/donate)

Cheers!

## Terraform documentation

## Requirements

| Name | Version |
|------|---------|
| terraform | >= 0.12.0 |

## Providers

No provider.

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| command | The command that's passed to the container. This parameter maps to Cmd in the Create a container section of the Docker Remote API and the COMMAND parameter to docker run. For more information, see https://docs.docker.com/engine/reference/builder/#cmd. | `list(string)` | `[]` | no |
| environment | The environment variables to pass to the container. This is a list of maps. https://docs.aws.amazon.com/batch/latest/APIReference/API_KeyValuePair.html | <pre>list(object({<br>    name  = string<br>    value = string<br>  }))</pre> | `[]` | no |
| execution\_role\_arn | The Amazon Resource Name (ARN) of the execution role that AWS Batch can assume. Jobs running on Fargate resources must provide an execution role. https://docs.aws.amazon.com/batch/latest/userguide/execution-IAM-role.html | `string` | `null` | no |
| fargate\_platform\_configuration | The platform configuration for jobs running on Fargate resources. Jobs running on EC2 resources must not specify this parameter. https://docs.aws.amazon.com/batch/latest/APIReference/API_FargatePlatformConfiguration.html | <pre>object({<br>    platform_version = string<br>  })</pre> | `null` | no |
| image | The image used to start a container. This string is passed directly to the Docker daemon. Images in the Docker Hub registry are available by default. Other repositories are specified with repository-url/image:tag . Up to 255 letters (uppercase and lowercase), numbers, hyphens, underscores, colons, periods, forward slashes, and number signs are allowed | `string` | n/a | yes |
| instance\_type | The instance type to use for a multi-node parallel job. All node groups in a multi-node parallel job must use the same instance type. | `string` | `null` | no |
| job\_role\_arn | The Amazon Resource Name (ARN) of the IAM role that the container can assume for AWS permissions. https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-iam-roles.html | `string` | `null` | no |
| linux\_parameters | Linux-specific modifications that are applied to the container, such as Linux kernel capabilities. For more details, see https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_LinuxParameters.html | <pre>object({<br>    capabilities = object({<br>      add  = list(string)<br>      drop = list(string)<br>    })<br>    devices = list(object({<br>      containerPath = string<br>      hostPath      = string<br>      permissions   = list(string)<br>    }))<br>    initProcessEnabled = bool<br>    maxSwap            = number<br>    sharedMemorySize   = number<br>    swappiness         = number<br>    tmpfs = list(object({<br>      containerPath = string<br>      mountOptions  = list(string)<br>      size          = number<br>    }))<br>  })</pre> | `null` | no |
| log\_configuration | The log configuration specification for the container. https://docs.aws.amazon.com/batch/latest/APIReference/API_LogConfiguration.html | <pre>object({<br>    logDriver = string<br>    options   = map(string)<br>    secretOptions = list(object({<br>      name      = string<br>      valueFrom = string<br>    }))<br>  })</pre> | `null` | no |
| memory | This parameter is deprecated and not supported for jobs run on Fargate resources, use ResourceRequirement. For jobs run on EC2 resources can specify the memory requirement using the ResourceRequirement structure. The hard limit (in MiB) of memory to present to the container. If your container attempts to exceed the memory specified here, the container is killed. This parameter maps to Memory in the Create a container section of the Docker Remote API and the --memory option to docker run. You must specify at least 4 MiB of memory for a job. This is required but can be specified in several places; it must be specified for each node at least once. | `number` | n/a | yes |
| mount\_points | The mount points for data volumes in your container. This parameter maps to Volumes in the Create a container section of the Docker Remote API and the --volume option to docker run. https://docs.aws.amazon.com/batch/latest/APIReference/API_MountPoint.html | <pre>list(object({<br>    containerPath = string<br>    sourceVolume  = string<br>    readOnly      = bool<br>  }))</pre> | `[]` | no |
| network\_configuration | The network configuration for jobs running on Fargate resources. Jobs running on EC2 resources must not specify this parameter. https://docs.aws.amazon.com/batch/latest/APIReference/API_NetworkConfiguration.html | <pre>object({<br>    assignPublicIp = string<br>  })</pre> | `null` | no |
| privileged | When this variable is `true`, the container is given elevated privileges on the host container instance (similar to the root user). This parameter is not supported for Windows containers or tasks using the Fargate launch type. | `bool` | `null` | no |
| readonly\_root\_filesystem | When this parameter is true, the container is given read-only access to its root file system. This parameter maps to ReadonlyRootfs in the Create a container section of the Docker Remote API and the --read-only option to docker run. | `bool` | `null` | no |
| resource\_requirements | The type and amount of resources to assign to a container. The supported resources include GPU, MEMORY, and VCPU. https://docs.aws.amazon.com/batch/latest/APIReference/API_ResourceRequirement.html | <pre>list(object({<br>    type  = string<br>    value = string<br>  }))</pre> | `[]` | no |
| secrets | The secrets for the container. https://docs.aws.amazon.com/batch/latest/APIReference/API_Secret.html | <pre>list(object({<br>    name      = string<br>    valueFrom = string<br>  }))</pre> | `[]` | no |
| ulimits | A list of ulimits to set in the container. This parameter maps to Ulimits in the Create a container section of the Docker Remote API and the --ulimit option to docker run. This parameter isn't applicable to jobs running on Fargate resources and shouldn't be provided. | <pre>list(object({<br>    name      = string<br>    hardLimit = number<br>    softLimit = number<br>  }))</pre> | `[]` | no |
| user | The user name to use inside the container. This parameter maps to User in the Create a container section of the Docker Remote API and the --user option to docker run. | `string` | `null` | no |
| vcpus | This parameter is deprecated and not supported for jobs run on Fargate resources, see resourceRequirement. The number of vCPUs reserved for the container. Jobs running on EC2 resources can specify the vCPU requirement for the job using resourceRequirements but the vCPU requirements can't be specified both here and in the resourceRequirement structure. This parameter maps to CpuShares in the Create a container section of the Docker Remote API and the --cpu-shares option to docker run. Each vCPU is equivalent to 1,024 CPU shares. You must specify at least one vCPU. This is required but can be specified in several places. It must be specified for each node at least once. | `number` | n/a | yes |
| volumes | A list of data volumes used in a job. https://docs.aws.amazon.com/batch/latest/APIReference/API_Volume.html | <pre>list(object({<br>    host = object({<br>      sourcePath = string<br>    })<br>    name = string<br>  }))</pre> | `[]` | no |

## Outputs

| Name | Description |
|------|-------------|
| json\_map\_encoded | JSON string encoded container properties. |
| json\_map\_encoded\_list | JSON string encoded list of container properties. |
| json\_map\_object | JSON map encoded container properties. |

